<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>所有課程</title>
    <link rel="stylesheet" href="recommend.css">
    <script>
        document.addEventListener('DOMContentLoaded', fetchFavorites);

        // 獲取收藏課程
        async function fetchFavorites() {
            try {
                const response = await fetch('/api/courses/favorites');
                if (!response.ok) {
                    throw new Error('無法獲取收藏課程');
                }
                const favorites = await response.json();
                displayFavorites(favorites);
            } catch (error) {
                console.error('Error fetching favorites:', error);
            }
        }

        // 顯示收藏課程
        function displayFavorites(favorites) {
            const categories = {
                'sky': document.getElementById('sky'),
                'people': document.getElementById('people'),
                'thing': document.getElementById('thing'),
                'self': document.getElementById('self')
            };

            // 清空現有內容
            for (const category in categories) {
                const categoryDiv = categories[category];
                categoryDiv.innerHTML = '<h2>' + getCategoryName(category) + '</h2>';
            }

            favorites.forEach(favorite => {
                const category = favorite.category;
                const categoryDiv = categories[category];
                if (categoryDiv) {
                    const favoriteItem = document.createElement('div');
                    favoriteItem.className = 'recommendation-item';

                    const title = document.createElement('h2');
                    title.textContent = favorite.course_name;

                    const description = document.createElement('p');
                    description.textContent = `MBTI類型: ${favorite.mbti_type}\nCEEC類型: ${favorite.ceec_type}`;

                    const link = document.createElement('a');
                    link.href = favorite.link;
                    link.textContent = '查看課程';

                    const deleteButton = document.createElement('button');
                    deleteButton.textContent = '刪除收藏';
                    deleteButton.onclick = async () => {
                        try {
                            const response = await fetch(`/api/courses/favorites/${favorite.id}`, {
                                method: 'DELETE',
                            });

                            if (response.ok) {
                                alert('收藏已刪除！');
                                fetchFavorites(); // 刷新收藏列表
                            } else {
                                alert('刪除失敗，請稍後再試。');
                            }
                        } catch (error) {
                            console.error('刪除錯誤:', error);
                            alert('發生錯誤，請稍後再試。');
                        }
                    };

                    favoriteItem.appendChild(title);
                    favoriteItem.appendChild(description);
                    favoriteItem.appendChild(link);
                    favoriteItem.appendChild(deleteButton);

                    categoryDiv.appendChild(favoriteItem);
                }
            });
        }

        function getCategoryName(category) {
            switch (category) {
                case 'sky':
                    return '天';
                case 'people':
                    return '人';
                case 'thing':
                    return '物';
                case 'self':
                    return '我';
                default:
                    return '';
            }
        }
    </script>
</head>
<body>
    <header>
        <h1>所有課程</h1>
    </header>

    <nav>
        <ul>
            <li><a href="input.html">MBTI與CEEC輸入</a></li>
            <li><a href="recommend.html">推薦結果</a></li>
            <li><a href="course.html">全部課程查詢</a></li>
            <li><a href="collection.html">收藏課程</a></li>
            <li><a href="QA.html">常見Q&A</a></li>
            <li><a href="personal.html">個人資料與使用紀錄</a></li>
        </ul>
    </nav>

    <div class="container">
        <h1>分類課程</h1>
        <nav>
            <ul>
                <li><a href="#" onclick="showCategory('sky')">天</a></li>
                <li><a href="#" onclick="showCategory('people')">人</a></li>
                <li><a href="#" onclick="showCategory('thing')">物</a></li>
                <li><a href="#" onclick="showCategory('self')">我</a></li>
            </ul>
        </nav>

        <div id="sky" class="course-category">
            <h2>天</h2>
            <!-- 課程動態 -->
        </div>

        <div id="people" class="course-category" style="display: none;">
            <h2>人</h2>
            <!-- 課程動態 -->
        </div>

        <div id="thing" class="course-category" style="display: none;">
            <h2>物</h2>
            <!-- 課程動態 -->
        </div>

        <div id="self" class="course-category" style="display: none;">
            <h2>我</h2>
            <!-- 課程動態 -->
        </div>
    </div>
</body>
</html>
